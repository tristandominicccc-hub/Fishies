local MobileGUI = {}

function MobileGUI:CreateWindow(title)
    local self = setmetatable({}, {__index = MobileGUI})
    
    local Players = game:GetService("Players")
    local Player = Players.LocalPlayer
    local PlayerGui = Player:WaitForChild("PlayerGui")

    -- Create main screen GUI
    self.ScreenGui = Instance.new("ScreenGui")
    self.ScreenGui.Name = "MobileGUI"
    self.ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    self.ScreenGui.Parent = PlayerGui

    -- Main frame (HORIZONTAL LAYOUT)
    self.MainFrame = Instance.new("Frame")
    self.MainFrame.Name = "MainFrame"
    self.MainFrame.Size = UDim2.new(0, 380, 0, 280)
    self.MainFrame.Position = UDim2.new(0.5, -190, 0.5, -140)
    self.MainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    self.MainFrame.BorderSizePixel = 0
    self.MainFrame.ClipsDescendants = true
    self.MainFrame.Parent = self.ScreenGui

    -- Corner
    local Corner = Instance.new("UICorner")
    Corner.CornerRadius = UDim.new(0, 6)
    Corner.Parent = self.MainFrame

    -- Stroke
    local Stroke = Instance.new("UIStroke")
    Stroke.Color = Color3.fromRGB(80, 80, 80)
    Stroke.Thickness = 2
    Stroke.Parent = self.MainFrame

    -- Title bar (HORIZONTAL)
    local TitleBar = Instance.new("Frame")
    TitleBar.Name = "TitleBar"
    TitleBar.Size = UDim2.new(1, 0, 0, 35)
    TitleBar.Position = UDim2.new(0, 0, 0, 0)
    TitleBar.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    TitleBar.BorderSizePixel = 0
    TitleBar.Parent = self.MainFrame

    local TitleCorner = Instance.new("UICorner")
    TitleCorner.CornerRadius = UDim.new(0, 6)
    TitleCorner.Parent = TitleBar

    -- Title text
    local TitleText = Instance.new("TextLabel")
    TitleText.Name = "TitleText"
    TitleText.Size = UDim2.new(0, 150, 1, 0)
    TitleText.Position = UDim2.new(0, 10, 0, 0)
    TitleText.BackgroundTransparency = 1
    TitleText.Text = title or "duminik.gg"
    TitleText.TextColor3 = Color3.fromRGB(255, 255, 255)
    TitleText.TextXAlignment = Enum.TextXAlignment.Left
    TitleText.Font = Enum.Font.GothamBold
    TitleText.TextSize = 14
    TitleText.Parent = TitleBar

    -- Minimize button
    self.MinimizeButton = Instance.new("TextButton")
    self.MinimizeButton.Name = "MinimizeButton"
    self.MinimizeButton.Size = UDim2.new(0, 25, 0, 25)
    self.MinimizeButton.Position = UDim2.new(1, -55, 0.5, -12.5)
    self.MinimizeButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    self.MinimizeButton.BorderSizePixel = 0
    self.MinimizeButton.Text = "â€“"
    self.MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    self.MinimizeButton.Font = Enum.Font.GothamBold
    self.MinimizeButton.TextSize = 16
    self.MinimizeButton.Parent = TitleBar

    local MinCorner = Instance.new("UICorner")
    MinCorner.CornerRadius = UDim.new(0, 4)
    MinCorner.Parent = self.MinimizeButton

    -- Exit button
    self.ExitButton = Instance.new("TextButton")
    self.ExitButton.Name = "ExitButton"
    self.ExitButton.Size = UDim2.new(0, 25, 0, 25)
    self.ExitButton.Position = UDim2.new(1, -25, 0.5, -12.5)
    self.ExitButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
    self.ExitButton.BorderSizePixel = 0
    self.ExitButton.Text = "X"
    self.ExitButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    self.ExitButton.Font = Enum.Font.GothamBold
    self.ExitButton.TextSize = 12
    self.ExitButton.Parent = TitleBar

    local ExitCorner = Instance.new("UICorner")
    ExitCorner.CornerRadius = UDim.new(0, 4)
    ExitCorner.Parent = self.ExitButton

    -- Top Tabs for Horizontal Layout
    self.TopTabContainer = Instance.new("Frame")
    self.TopTabContainer.Name = "TopTabContainer"
    self.TopTabContainer.Size = UDim2.new(1, 0, 0, 40)
    self.TopTabContainer.Position = UDim2.new(0, 0, 0, 35)
    self.TopTabContainer.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    self.TopTabContainer.BorderSizePixel = 0
    self.TopTabContainer.Parent = self.MainFrame

    -- Content area (HORIZONTAL)
    self.ContentArea = Instance.new("Frame")
    self.ContentArea.Name = "ContentArea"
    self.ContentArea.Size = UDim2.new(1, 0, 1, -75)
    self.ContentArea.Position = UDim2.new(0, 0, 0, 75)
    self.ContentArea.BackgroundTransparency = 1
    self.ContentArea.Parent = self.MainFrame

    -- Tab management
    self.tabs = {}
    self.tabButtons = {}
    self.currentTab = nil

    -- Mobile drag functionality
    self:SetupDrag(TitleBar)

    -- Button functions
    self:SetupButtons()

    return self
end

function MobileGUI:SetupDrag(TitleBar)
    local UserInputService = game:GetService("UserInputService")
    local dragging = false
    local dragInput, dragStart, startPos

    local function update(input)
        local delta = input.Position - dragStart
        self.MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end

    TitleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = self.MainFrame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    TitleBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            update(input)
        end
    end)
end

function MobileGUI:SetupButtons()
    local isMinimized = false
    local originalSize = self.MainFrame.Size

    self.MinimizeButton.MouseButton1Click:Connect(function()
        isMinimized = not isMinimized
        if isMinimized then
            self.MainFrame.Size = UDim2.new(0, 380, 0, 35)
            self.TopTabContainer.Visible = false
            self.ContentArea.Visible = false
        else
            self.MainFrame.Size = originalSize
            self.TopTabContainer.Visible = true
            self.ContentArea.Visible = true
        end
    end)

    self.ExitButton.MouseButton1Click:Connect(function()
        self.ScreenGui:Destroy()
    end)

    -- Button hover effects
    self.MinimizeButton.MouseEnter:Connect(function()
        self.MinimizeButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
    end)

    self.MinimizeButton.MouseLeave:Connect(function()
        self.MinimizeButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    end)

    self.ExitButton.MouseEnter:Connect(function()
        self.ExitButton.BackgroundColor3 = Color3.fromRGB(220, 80, 80)
    end)

    self.ExitButton.MouseLeave:Connect(function()
        self.ExitButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
    end)
end

function MobileGUI:CreateTab(tabName, displayName)
    local tabKey = tabName
    self.tabs[tabKey] = {
        name = displayName or tabName,
        key = tabKey
    }

    -- Create tab button
    local tabButton = Instance.new("TextButton")
    tabButton.Name = tabKey .. "Tab"
    tabButton.Size = UDim2.new(1 / (table.getn(self.tabs) + 1), 0, 1, 0)
    tabButton.Position = UDim2.new((table.getn(self.tabs) - 1) / (table.getn(self.tabs) + 1), 0, 0, 0)
    tabButton.BackgroundColor3 = table.getn(self.tabs) == 1 and Color3.fromRGB(60, 60, 60) or Color3.fromRGB(35, 35, 35)
    tabButton.BorderSizePixel = 0
    tabButton.Text = displayName or tabName
    tabButton.TextColor3 = table.getn(self.tabs) == 1 and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(200, 200, 200)
    tabButton.Font = table.getn(self.tabs) == 1 and Enum.Font.GothamBold or Enum.Font.Gotham
    tabButton.TextSize = 9
    tabButton.Parent = self.TopTabContainer
    
    self.tabButtons[tabKey] = tabButton

    -- Create content frame
    local contentFrame = Instance.new("Frame")
    contentFrame.Name = tabKey .. "Content"
    contentFrame.Size = UDim2.new(1, 0, 1, 0)
    contentFrame.Position = UDim2.new(0, 0, 0, 0)
    contentFrame.BackgroundTransparency = 1
    contentFrame.Visible = table.getn(self.tabs) == 1
    contentFrame.Parent = self.ContentArea

    -- Create scroll frame
    local scroll, layout = self:CreateScrollFrame(contentFrame)

    -- Tab hover effects
    tabButton.MouseEnter:Connect(function()
        if tabButton.BackgroundColor3 ~= Color3.fromRGB(60, 60, 60) then
            tabButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
        end
    end)
    
    tabButton.MouseLeave:Connect(function()
        if tabButton.BackgroundColor3 ~= Color3.fromRGB(60, 60, 60) then
            tabButton.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
        end
    end)

    -- Connect tab button
    tabButton.MouseButton1Click:Connect(function()
        self:SwitchToTab(tabKey)
    end)

    -- Set first tab as active
    if table.getn(self.tabs) == 1 then
        self.currentTab = tabKey
    end

    -- Update all tab sizes
    self:UpdateTabSizes()

    return scroll, layout, contentFrame
end

function MobileGUI:UpdateTabSizes()
    local tabCount = table.getn(self.tabs)
    for i, tab in pairs(self.tabs) do
        local tabButton = self.tabButtons[tab.key]
        if tabButton then
            tabButton.Size = UDim2.new(1 / tabCount, 0, 1, 0)
            tabButton.Position = UDim2.new((i-1) / tabCount, 0, 0, 0)
        end
    end
end

function MobileGUI:SwitchToTab(tabKey)
    -- Hide all content frames
    for _, tab in pairs(self.tabs) do
        local contentFrame = self.ContentArea:FindFirstChild(tab.key .. "Content")
        if contentFrame then
            contentFrame.Visible = false
        end
    end

    -- Reset all tab buttons
    for _, tabButton in pairs(self.tabButtons) do
        tabButton.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
        tabButton.TextColor3 = Color3.fromRGB(200, 200, 200)
        tabButton.Font = Enum.Font.Gotham
    end

    -- Activate selected tab
    if self.tabButtons[tabKey] then
        self.tabButtons[tabKey].BackgroundColor3 = Color3.fromRGB(60, 60, 60)
        self.tabButtons[tabKey].TextColor3 = Color3.fromRGB(255, 255, 255)
        self.tabButtons[tabKey].Font = Enum.Font.GothamBold
        
        local contentFrame = self.ContentArea:FindFirstChild(tabKey .. "Content")
        if contentFrame then
            contentFrame.Visible = true
        end
        
        self.currentTab = tabKey
    end
end

function MobileGUI:CreateScrollFrame(parent)
    local scroll = Instance.new("ScrollingFrame")
    scroll.Size = UDim2.new(1, -5, 1, -5)
    scroll.Position = UDim2.new(0, 2, 0, 2)
    scroll.BackgroundTransparency = 1
    scroll.BorderSizePixel = 0
    scroll.ScrollBarThickness = 3
    scroll.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 100)
    scroll.CanvasSize = UDim2.new(0, 0, 0, 0)
    scroll.Parent = parent
    
    local layout = Instance.new("UIListLayout")
    layout.Padding = UDim.new(0, 5)
    layout.Parent = scroll

    -- Auto-update canvas size
    layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        scroll.CanvasSize = UDim2.new(0, 0, 0, layout.AbsoluteContentSize.Y + 10)
    end)
    
    return scroll, layout
end

function MobileGUI:CreateToggle(realName, displayName, description, parent, purchaseType, isMerchant)
    local ToggleFrame = Instance.new("Frame")
    ToggleFrame.Size = UDim2.new(1, 0, 0, 40)
    ToggleFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    ToggleFrame.BorderSizePixel = 0
    ToggleFrame.Parent = parent
    
    local ToggleCorner = Instance.new("UICorner")
    ToggleCorner.CornerRadius = UDim.new(0, 4)
    ToggleCorner.Parent = ToggleFrame
    
    local ToggleStroke = Instance.new("UIStroke")
    ToggleStroke.Color = Color3.fromRGB(80, 80, 80)
    ToggleStroke.Thickness = 1
    ToggleStroke.Parent = ToggleFrame
    
    local ToggleLabel = Instance.new("TextLabel")
    ToggleLabel.Size = UDim2.new(0.65, -8, 0.6, 0)
    ToggleLabel.Position = UDim2.new(0, 6, 0, 2)
    ToggleLabel.BackgroundTransparency = 1
    ToggleLabel.Text = displayName
    ToggleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    ToggleLabel.TextXAlignment = Enum.TextXAlignment.Left
    ToggleLabel.Font = Enum.Font.GothamBold
    ToggleLabel.TextSize = 11
    ToggleLabel.Parent = ToggleFrame
    
    local DescLabel = Instance.new("TextLabel")
    DescLabel.Size = UDim2.new(0.65, -8, 0.4, 0)
    DescLabel.Position = UDim2.new(0, 6, 0.6, 0)
    DescLabel.BackgroundTransparency = 1
    DescLabel.Text = description
    DescLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
    DescLabel.TextXAlignment = Enum.TextXAlignment.Left
    DescLabel.Font = Enum.Font.Gotham
    DescLabel.TextSize = 8
    DescLabel.Parent = ToggleFrame
    
    local ToggleButton = Instance.new("TextButton")
    ToggleButton.Size = UDim2.new(0, 50, 0, 22)
    ToggleButton.Position = UDim2.new(1, -55, 0.5, -11)
    ToggleButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    ToggleButton.BorderSizePixel = 0
    ToggleButton.Text = "OFF"
    ToggleButton.TextColor3 = Color3.fromRGB(255, 100, 100)
    ToggleButton.Font = Enum.Font.GothamBold
    ToggleButton.TextSize = 9
    ToggleButton.Parent = ToggleFrame
    
    local ButtonCorner = Instance.new("UICorner")
    ButtonCorner.CornerRadius = UDim.new(0, 4)
    ButtonCorner.Parent = ToggleButton
    
    -- Button hover effects
    ToggleButton.MouseEnter:Connect(function()
        if ToggleButton.Text == "OFF" then
            ToggleButton.BackgroundColor3 = Color3.fromRGB(90, 90, 90)
        else
            ToggleButton.BackgroundColor3 = Color3.fromRGB(70, 200, 90)
        end
    end)
    
    ToggleButton.MouseLeave:Connect(function()
        if ToggleButton.Text == "OFF" then
            ToggleButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
        else
            ToggleButton.BackgroundColor3 = Color3.fromRGB(60, 180, 80)
        end
    end)
    
    return ToggleButton, ToggleFrame
end

function MobileGUI:CreateButton(text, parent, height)
    height = height or 35
    
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1, -10, 0, height)
    button.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
    button.Text = text
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.Font = Enum.Font.GothamBold
    button.TextSize = 11
    button.Parent = parent

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = button
    
    return button
end

function MobileGUI:CreateLabel(text, parent, height)
    height = height or 25
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, -10, 0, height)
    label.BackgroundColor3 = Color3.fromRGB(50, 50, 70)
    label.Text = text
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.Font = Enum.Font.Gotham
    label.TextSize = 9
    label.Parent = parent

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = label
    
    return label
end

return MobileGUI
